Fase 1: Pre-processing "Semantic-Aware"Obiettivo: Ridurre il rumore rispettando la biologia.Filtraggio per Frequenza:Rimuovi termini $< 3$ geni (troppo rari) e $> 20\%$ dei geni (troppo generici).Semantic Redundancy Removal (Miglioramento):Invece di Jaccard, calcola la Similarità Semantica (es. Wang o Resnik) tra i termini all'interno dello stesso DAG (Grafo Aciclico Diretto).Algoritmo: Se $Sim(t_1, t_2) > 0.7$ E $t_1$ è antenato di $t_2$, scarta $t_1$ (mantieni l'informazione più specifica/informativa).Gestione Geni Orfani:Elimina i geni che, dopo il filtraggio dei termini, hanno vettori [0,0,...,0] in tutte le viste.Fase 2: Feature Engineering & TrasformazioneObiettivo: Preparare gli input per le due strade parallele (SNF e MOFA).Calcolo TF-IDF:Applicato alle matrici binarie.$W_{i,j} = tf_{i,j} \times \log(\frac{N}{df_j})$.Creazione Matrici di Input:Per SNF: Calcola le matrici di similarità (Gene $\times$ Gene) usando Cosine Similarity sulle matrici TF-IDF.$$S_{view} = \frac{X_{tfidf} \cdot X_{tfidf}^T}{||X|| \cdot ||X||^T}$$Per MOFA: Mantieni le matrici TF-IDF (Gene $\times$ Termini) come input diretto ("Views").Fase 3: Dual Integration Strategy (Il cuore della pipeline)Qui la pipeline si biforca per catturare aspetti diversi dei dati.Strada A: Similarity Network Fusion (SNF) - Topologia LocaleObiettivo: Fondere le similarità amplificando i legami forti.Gestione HPO: Includi la matrice di similarità HPO ma assegna un peso inferiore se molto sparsa, oppure fidati della fusione iterativa che penalizza naturalmente le viste rumorose.Parametri: $K$ dinamico (es. 20), $t=20$ iterazioni.Output A: Matrice fusa $W_{fused}$ (Gene $\times$ Gene).Strada B: MOFA+ (Multi-Omics Factor Analysis) - Varianza GlobaleObiettivo: Estrarre fattori latenti che spiegano la variabilità condivisa o privata tra le viste. MOFA gestisce nativamente i dati sparsi (ottimo per HPO).Input: Le 4 matrici TF-IDF (CC, MF, BP, HPO).Processo:Modellazione Bayesiana per fattorizzare le matrici: $Y_{view} = Z \cdot W_{view}^T + \epsilon$.Estrazione di $Z$ (Fattori Latenti): Una matrice (Geni $\times$ Fattori) es. 5183 $\times$ 15.Output B: Matrice dei Fattori Latenti $Z_{MOFA}$.Fase 4: Integrazione Dimensionale & Proiezione (Convergenza)Obiettivo: Unire la topologia di SNF con la spiegabilità globale di MOFA per la proiezione finale.Invece di usare un'inizializzazione casuale o spettrale standard per UMAP, usiamo i fattori di MOFA per guidare la struttura globale, mentre SNF definisce le distanze locali.UMAP Guidato:Metrica: Usa la distanza derivata da SNF ($D = 1 - W_{fused}$).Inizializzazione: Usa i primi $N$ fattori di MOFA ($Z_{MOFA}$) come punto di partenza per l'embedding.Perché: Questo assicura che la disposizione globale dei cluster rispetti i driver biologici principali identificati da MOFA, mentre i dettagli fini sono definiti dalla rete SNF.Python# Concetto Python
import umap

# D_snf = Distanza derivata dalla matrice fusa SNF
# Z_mofa = Fattori latenti estratti da MOFA (es. PCA-like ridotta a 2 dimensioni o più)

mapper = umap.UMAP(
    metric='precomputed', # Usa la topologia SNF
    init=Z_mofa[:, :2],   # Inizializza con la struttura globale MOFA (scalata)
    n_neighbors=30,
    min_dist=0.1
).fit(D_snf)
Fase 5: Clustering Robusto (Soft Clustering)Obiettivo: Identificare gruppi di geni funzionalmente correlati senza forzare il rumore.HDBSCAN:Input: L'embedding UMAP generato sopra.Parametri: min_cluster_size=30, min_samples=10.Soft Clustering:Genera vettori di probabilità per ogni gene ($P(gene \in Cluster_i)$).Recupero Rumore: Se un gene è classificato come -1 (rumore) ma ha una probabilità $> 0.3$ per il Cluster X, riassegnalo al Cluster X. Questo riduce la perdita di informazioni.Fase 6: Validazione & Explainability (Biologica)Obiettivo: Dare un senso ai cluster usando sia statistiche classiche che i fattori MOFA.A. Enrichment Analysis (Validazione Esterna)Per ogni cluster, esegui test ipergeometrico su KEGG/Reactome (FDR < 0.05).Output: "Il Cluster 3 è legato alla Fosforilazione Ossidativa".B. MOFA Factor Characterization (Validazione Interna)Usa i pesi ("weights") di MOFA per capire perché i cluster si separano.Analizza quali viste (BP, CC, MF, HPO) pesano di più sui Fattori Latenti che separano i cluster.Esempio: "Il Cluster 1 e 2 sono separati lungo il Fattore 1, che è guidato al 80% dalla vista HPO (termini legati a dismorfismi)."